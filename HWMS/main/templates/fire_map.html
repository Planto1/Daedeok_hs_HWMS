<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Korea Fire Detection Map</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="m-0 p-0 font-sans">
    <!-- ì‚¬ì´ë“œë°” -->
    <div id="sidebar" class="fixed left-0 top-0 h-full w-80 bg-white shadow-lg transform -translate-x-full transition-transform duration-300 z-10">
        <div class="p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">í™”ì¬ ì •ë³´</h2>
            </div>
            <div class="space-y-4">
                <p class="text-gray-600">í™”ì¬ ê°ì§€ ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                <div class="border-t pt-4">
                    <h3 class="font-semibold text-lg mb-2">í†µê³„</h3>
                    <p class="text-sm text-gray-600">ì´ í™”ì¬ ê±´ìˆ˜: <span id="fireCount" class="font-bold text-red-600">0</span></p>
                </div>
            </div>
        </div>
        
        <!-- ì‚¬ì´ë“œë°” í† ê¸€ ë²„íŠ¼ (ì˜¤ë¥¸ìª½ ê°€ì¥ìë¦¬) -->
        <button id="toggleSidebar" class="absolute right-0 top-1/2 transform translate-x-full -translate-y-1/2 bg-white shadow-lg rounded-r-lg px-2 py-8 hover:bg-gray-50 transition-colors">
            <span id="arrowIcon" class="text-xl font-bold text-gray-600">â—€</span>
        </button>
    </div>

    <div id="googleMap" class="w-full h-screen"></div>

    <script>
    // ì‚¬ì´ë“œë°” ì œì–´
    const sidebar = document.getElementById('sidebar');
    const toggleBtn = document.getElementById('toggleSidebar');
    const arrowIcon = document.getElementById('arrowIcon');

    toggleBtn.addEventListener('click', function() {
        const isOpen = !sidebar.classList.contains('-translate-x-full');
        
        if (isOpen) {
            // ë‹«ê¸°
            sidebar.classList.add('-translate-x-full');
            arrowIcon.textContent = 'â–¶';
        } else {
            // ì—´ê¸°
            sidebar.classList.remove('-translate-x-full');
            arrowIcon.textContent = 'â—€';
        }
    });

    </script>
    <script>
    function myMap(){
        var mapOptions = { 
            center: new google.maps.LatLng(36.5, 127.5),
            zoom: 7
        };
    
        var map = new google.maps.Map( 
            document.getElementById("googleMap"), 
            mapOptions 
        );

        // Django APIì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        fetch('/api/fire-data/')
            .then(response => response.json())
            .then(data => {
                console.log('ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', data.length + 'ê°œ');
                
                data.forEach(function(fire) {
                    // ë§ˆì»¤ ìƒì„±
                    var marker = new google.maps.Marker({
                        position: new google.maps.LatLng(fire.latitude, fire.longitude),
                        map: map,
                        icon: {
                            path: google.maps.SymbolPath.CIRCLE,
                            fillColor: fire.frp > 5 ? '#FF0000' : '#FF6600',
                            fillOpacity: 0.8,
                            strokeColor: '#8B0000',
                            strokeWeight: 2,
                            scale: Math.max(5, fire.frp * 2)
                        }
                    });

                    // ì •ë³´ì°½
                    var infowindow = new google.maps.InfoWindow({
                        content: `
                            <div class="p-2.5 font-sans">
                                <h3 class="m-0 mb-2.5 text-red-700">ğŸ”¥ í™”ì¬ ê°ì§€</h3>
                                <p class="my-1.5"><strong>ìœ„ì¹˜:</strong> ${fire.latitude.toFixed(4)}, ${fire.longitude.toFixed(4)}</p>
                                <p class="my-1.5"><strong>FRP:</strong> ${fire.frp} MW</p>
                                <p class="my-1.5"><strong>ì˜¨ë„:</strong> ${fire.bright_ti4}K</p>
                                <p class="my-1.5"><strong>ë‚ ì§œ:</strong> ${fire.acq_date}</p>
                                <p class="my-1.5"><strong>ì‹œê°„:</strong> ${fire.acq_time}</p>
                                <p class="my-1.5"><strong>ìœ„ì„±:</strong> ${fire.satellite}</p>
                                <p class="my-1.5"><strong>ì‹ ë¢°ë„:</strong> ${fire.confidence}</p>
                            </div>
                        `
                    });

                    // ë§ˆì»¤ í´ë¦­ ì´ë²¤íŠ¸
                    marker.addListener('click', function() {
                        infowindow.open(map, marker);
                    });
                });
                
                // í™”ì¬ ê±´ìˆ˜ ì—…ë°ì´íŠ¸
                document.getElementById('fireCount').textContent = data.length;
            })
            .catch(error => {
                console.error('Error loading fire data:', error);
                alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });
    }
    </script> 
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDMgR74mjlB4MutK1-jqO8gthz-T45jtXg&callback=myMap"></script>
</body>
</html>